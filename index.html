<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Operating Systems Final</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* Make the page body 400px wide and center it horizontally */
        body {
            width: 400px;
            height: 600px;
            margin: auto;
            margin-top: 30px;
            border: 3px solid black;
            border-radius: 10px;
        }
        html {
            height: 100vh;
        }
        #afterClick {
            height: 400px;
        }
    </style>
</head>
<body>
    <h1 class="text-center pt-3">CIA Pack Tool</h1>
    <hr>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
    <div class="d-flex justify-content-center" id="myTab" role="tablist">
        <button class="btn btn-secondary me-3" id="unpack-tab" type="button" role="tab">Unpack</button>
        <button class="btn btn-secondary" id="repack-tab" type="button" role="tab">Repack</button>
    </div>
    <div id="afterClick">
        <hr id="afterClickHr" style="display: none;">
        <div id="selectFileButtons" class="d-flex flex-column justify-content-center h-100 align-items-center" style="display: none;">
            <button class="btn btn-primary fs-2 mb-3" id="selectFile" style="display: none;">Select CIA</button>
            <button class="btn btn-secondary mb-3" id="selectFolder" style="display: none;">Select Folder</button>
            <div class="mt-4 bg-secondary card text-white p-3" id="advancedOptions" style="display: none;">
                <h2 class="h5 mb-3">Advanced Options</h2>
                <div class="form-check mb-2">
                    <label class="form-check-label" for="useRandomTID">
                        Use Random TID
                    </label>
                    <input class="form-check-input" type="checkbox" value="" id="useRandomTID" checked>
                </div>
                <div class="mb-2" id="titleIdGroup">
                    <label for="titleIdInput" class="form-label">Title ID</label>
                    <input type="text" id="titleIdInput" placeholder="Enter Title ID">
                </div>
            </div>
        </div>
    </div>
    <div id="successDiv" style="display: none;">
        <hr>
        <div class="text-success fs-1 fw-bold text-center mb-4">Success!</div>
        <div class="d-flex justify-content-center mb-3">
            <button id="downloadBtn" class="btn btn-primary"></button>
        </div>
        <hr>
        <div class="p-1">
            <strong>Title Info:</strong><br>
            Name: Tetris<br>
            Publisher: Nintendo<br>
            Title ID: 00040000001AB800
        </div>
    </div>
    <script>
        // Toggle logic for Unpack/Repack
        const unpackTab = document.getElementById('unpack-tab');
        const repackTab = document.getElementById('repack-tab');
        const afterClickHr = document.getElementById('afterClickHr');
        const selectFileButtons = document.getElementById('selectFileButtons');
        const selectFile = document.getElementById('selectFile');
        const selectFolder = document.getElementById('selectFolder');
        const advancedOptions = document.getElementById('advancedOptions');
        const afterClick = document.getElementById('afterClick');
        const successDiv = document.getElementById('successDiv');
        const downloadBtn = document.getElementById('downloadBtn');

        let currentMode = "unpack"; // "unpack" or "repack"

        function showUnpack() {
            currentMode = "unpack";
            unpackTab.classList.add('btn-primary');
            unpackTab.classList.remove('btn-secondary');
            repackTab.classList.remove('btn-primary');
            repackTab.classList.add('btn-secondary');

            afterClickHr.style.display = '';
            selectFileButtons.style.display = '';
            selectFile.style.display = '';
            selectFile.textContent = 'Select CIA';
            selectFolder.style.display = 'none';
            advancedOptions.style.display = 'none';
            afterClick.style.display = '';
            successDiv.style.display = 'none';
        }

        function showRepack() {
            currentMode = "repack";
            repackTab.classList.add('btn-primary');
            repackTab.classList.remove('btn-secondary');
            unpackTab.classList.remove('btn-primary');
            unpackTab.classList.add('btn-secondary');

            afterClickHr.style.display = '';
            selectFileButtons.style.display = '';
            selectFile.style.display = '';
            selectFile.textContent = 'Select ZIP';
            selectFolder.style.display = '';
            advancedOptions.style.display = '';
            afterClick.style.display = '';
            successDiv.style.display = 'none';
        }

        // Hide everything on load
        afterClickHr.style.display = 'none';
        selectFileButtons.style.display = 'none';
        selectFile.style.display = 'none';
        selectFolder.style.display = 'none';
        advancedOptions.style.display = 'none';
        afterClick.style.display = '';
        successDiv.style.display = 'none';

        unpackTab.addEventListener('click', showUnpack);
        repackTab.addEventListener('click', showRepack);

        // Advanced Options logic (show Title ID only if unchecked)
        const useRandomTID = document.getElementById('useRandomTID');
        const titleIdGroup = document.getElementById('titleIdGroup');
        useRandomTID.addEventListener('change', function() {
            titleIdGroup.style.opacity = this.checked ? '0' : '1';
        });
        // Initialize on page load
        titleIdGroup.style.opacity = useRandomTID.checked ? '0' : '1';

        // File/folder picker logic
        selectFile.addEventListener('click', async function() {
            try {
                await window.showOpenFilePicker();
            } catch (e) {
                // User cancelled or not supported
            }
            showSuccess();
        });

        selectFolder.addEventListener('click', async function() {
            try {
                await window.showDirectoryPicker();
            } catch (e) {
                // User cancelled or not supported
            }
            showSuccess();
        });

        function showSuccess() {
            afterClick.style.display = 'none';
            successDiv.style.display = '';
            if (currentMode === "unpack") {
                downloadBtn.textContent = "Download ZIP";
            } else {
                downloadBtn.textContent = "Download CIA";
            }
        }
    </script>
</body>
</html>